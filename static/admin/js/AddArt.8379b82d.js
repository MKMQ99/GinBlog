"use strict";(self["webpackChunkadmin"]=self["webpackChunkadmin"]||[]).push([[849],{87460:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("a-card",[e("h3",[t._v(t._s(t.id?"编辑文章":"新增文章"))]),e("a-form-model",{ref:"artInfoRef",attrs:{model:t.artInfo,rules:t.artInfoRules,hideRequiredMark:!0}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{span:16}},[e("a-form-model-item",{attrs:{label:"文章标题",prop:"title"}},[e("a-input",{staticStyle:{width:"300px"},model:{value:t.artInfo.title,callback:function(e){t.$set(t.artInfo,"title",e)},expression:"artInfo.title"}})],1),e("a-form-model-item",{attrs:{label:"文章描述",prop:"desc"}},[e("a-input",{attrs:{type:"textarea"},model:{value:t.artInfo.desc,callback:function(e){t.$set(t.artInfo,"desc",e)},expression:"artInfo.desc"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"文章分类",prop:"cid"}},[e("a-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择分类"},on:{change:t.cateChange},model:{value:t.artInfo.cid,callback:function(e){t.$set(t.artInfo,"cid",e)},expression:"artInfo.cid"}},t._l(t.Catelist,(function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(" "+t._s(a.name)+" ")])})),1)],1),e("a-form-model-item",{attrs:{label:"文章缩略图",prop:"img"}},[e("a-upload",{attrs:{listType:"picture",name:"file",action:t.upUrl,headers:t.headers},on:{change:t.upChange}},[e("a-button",[e("a-icon",{attrs:{type:"upload"}}),t._v("点击上传 ")],1),t.id?[e("img",{staticStyle:{width:"120px",height:"100px","margin-left":"15px"},attrs:{src:t.artInfo.img}})]:t._e()],2)],1)],1)],1),e("a-form-model-item",{attrs:{label:"文章内容",prop:"content"}},[e("mavon-editor",{model:{value:t.artInfo.content,callback:function(e){t.$set(t.artInfo,"content",e)},expression:"artInfo.content"}})],1),e("a-form-model-item",[e("a-button",{staticStyle:{"margin-right":"15px"},attrs:{type:"danger"},on:{click:function(e){return t.artOk(t.artInfo.id)}}},[t._v(" "+t._s(t.artInfo.id?"更新":"提交")+" ")]),e("a-button",{attrs:{type:"primary"},on:{click:t.addCancel}},[t._v("取消")])],1)],1)],1)],1)},r=[],i=(a(57658),a(13795)),n={props:["id"],data(){return{artInfo:{id:0,title:"",cid:void 0,desc:"",content:"",img:""},Catelist:[],upUrl:i.R+"upload",headers:{},fileList:[],artInfoRules:{title:[{required:!0,message:"请输入文章标题",trigger:"change"}],cid:[{required:!0,message:"请选择文章分类",trigger:"change"}],desc:[{required:!0,message:"请输入文章描述",trigger:"change"},{max:120,message:"描述最多可写120个字符",trigger:"change"}],content:[{required:!0,message:"请输入文章内容",trigger:"change"}]}}},mounted(){this.getCateList(),this.headers={Authorization:`Bearer ${window.sessionStorage.getItem("token")}`},this.id&&this.getArtInfo(this.id)},methods:{async getArtInfo(t){const{data:e}=await this.$http.get(`admin/article/info/${t}`);200===e.status?(this.artInfo=e.data,this.artInfo.id=e.data.ID):this.$message.error(e.message)},async getCateList(){const{data:t}=await this.$http.get("admin/category");if(200!==t.status)return this.$message.error(t.message);this.Catelist=t.data},cateChange(t){this.artInfo.cid=t},upChange(t){"done"===t.file.status?(this.$message.success("图片上传成功"),this.artInfo.img=t.file.response.url):"error"===t.file.status&&this.$message.error("图片上传失败")},artOk(t){this.$refs.artInfoRef.validate((async e=>{if(!e)return this.$message.error("参数验证未通过，请按要求录入文章内容");if(0===t){const{data:t}=await this.$http.post("article/add",this.artInfo);if(200!==t.status)return this.$message.error(t.message);this.$router.push("/artlist"),this.$message.success("添加文章成功")}else{const{data:e}=await this.$http.put(`article/${t}`,this.artInfo);if(200!==e.status)return this.$message.error(e.message);this.$router.push("/artlist"),this.$message.success("更新文章成功")}}))},addCancel(){this.$refs.artInfoRef.resetFields()}}},o=n,l=a(1001),c=(0,l.Z)(o,s,r,!1,null,null,null),d=c.exports}}]);
//# sourceMappingURL=AddArt.8379b82d.js.map